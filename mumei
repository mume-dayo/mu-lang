#!/usr/bin/env python3
"""
Mumei Programming Language
Main executable - use 'mumei' command to run .mu files
"""

import sys
import os

# スクリプトのディレクトリをパスに追加
script_dir = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, script_dir)

from mm_interpreter import Interpreter


def print_banner():
    print("=" * 50)
    print("Mumei Programming Language Interpreter")
    print("Type 'exit' or press Ctrl+C to quit")
    print("=" * 50)


def repl():
    """Read-Eval-Print Loop (REPL)"""
    interpreter = Interpreter()
    print_banner()

    while True:
        try:
            source = input("mumei> ")

            if source.strip() in ('exit', 'quit'):
                print("Goodbye!")
                break

            if not source.strip():
                continue

            interpreter.run(source)

        except KeyboardInterrupt:
            print("\nGoodbye!")
            break
        except EOFError:
            print("\nGoodbye!")
            break
        except Exception as e:
            print(f"Error: {e}")


def run_file(filename: str):
    """Run a .mu file"""
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            source = f.read()

        interpreter = Interpreter()
        interpreter.run(source)

    except FileNotFoundError:
        print(f"Error: File '{filename}' not found")
        sys.exit(1)
    except Exception as e:
        print(f"Error: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)


def show_help():
    """Show help message"""
    print("Mumei Programming Language")
    print()
    print("Usage:")
    print("  mumei              # Start interactive REPL")
    print("  mumei <file.mu>    # Run a Mumei program file")
    print("  mumei --help       # Show this help message")
    print("  mumei --version    # Show version information")
    print()
    print("Examples:")
    print("  mumei hello.mu")
    print("  mumei examples/fibonacci.mu")


def show_version():
    """Show version information"""
    print("Mumei Programming Language v1.0.0")
    print("A simple, Python-inspired programming language")


def main():
    if len(sys.argv) == 1:
        # REPLモード
        repl()
    elif len(sys.argv) == 2:
        arg = sys.argv[1]

        if arg in ('--help', '-h', 'help'):
            show_help()
        elif arg in ('--version', '-v', 'version'):
            show_version()
        else:
            # ファイル実行モード
            filename = arg
            run_file(filename)
    else:
        print("Error: Too many arguments")
        print("Use 'mumei --help' for usage information")
        sys.exit(1)


if __name__ == '__main__':
    main()
